# 🎯 善庄狙击 V5 - Smart Money Sniper

## 功能概述

善庄狙击系统是集成在 A股期货情报终端中的智能选股模块，通过分析龙虎榜数据，自动追踪高胜率游资的潜伏标的，并提供实时操作建议。

## 核心特性

### 1. 📊 数据源
- **龙虎榜数据**: PostgreSQL数据库中的 `lhb_detail` 表
- **实时行情**: 通过 AkShare 获取竞价数据和盘中行情
- **行业信息**: 东方财富个股资料接口

### 2. 🎯 选股逻辑

#### 第一步：筛选高胜率游资
- 统计近60天所有游资的 T+2 胜率
- 筛选操作次数 ≥ 5次的活跃席位
- 只关注胜率 ≥ 50% 的"善庄"
- 过滤机构和陆股通席位

#### 第二步：定位潜伏标的
- 查找最近5天善庄买入的股票
- 分析每只股票的庄家组合
- 记录最高胜率和买入总金额

#### 第三步：多因子评分
基于以下因子对标的进行打分（满分100+）：

| 因子 | 评分规则 |
|------|---------|
| **竞价金额** | >3000万(+20分), >1000万(+10分) |
| **竞价换手率** | >0.8%(+20分) |
| **量比** | >5(+15分), >2(+10分) |
| **涨幅** | 1-5%(+25分), 5-8%且量大(+15分), <-2%(-20分) |
| **庄家胜率** | ≥80%(+20分), ≥60%(+10分) |
| **流通市值** | <30亿(+5分) |

#### 第四步：生成操作建议
根据评分和市场状态，自动生成：
- **买入计划**: 激进/稳健/观察/严禁追高
- **T+1卖出策略**: 根据评分给出具体止盈止损位

### 3. 🔍 筛选条件
- 竞价金额 ≥ 300万（过滤冷门股）
- 综合评分 ≥ 40分（质量门槛）
- 实时行情有效（开盘价 > 0）

### 4. 📈 排序规则
结果按以下优先级降序排列：
1. 庄家最高胜率（高→低）
2. 综合评分（高→低）
3. 流通市值（小→大）

**首推标的即为列表第一行**

## 使用方法

### 启动应用
```bash
cd streamlite-stock
streamlit run furtures_terminal.py
```

### 访问功能
1. 打开浏览器访问 `http://localhost:8501`
2. 点击 **"🎯 善庄狙击"** 标签页
3. 点击 **"🔄 刷新狙击池"** 获取最新数据

### 界面说明

#### 顶部统计卡片
- 🎯 **狙击标的**: 当前符合条件的股票数量
- ⭐ **最高评分**: 池内最高分数
- 🏆 **最高胜率**: 潜伏庄家的最高胜率
- 👥 **活跃游资**: 近60天活跃席位总数

#### 首推标的卡片
- 以紫色渐变卡片高亮显示
- 包含完整的操作建议
- 显示潜伏庄家信息

#### 完整列表
- 可交互的数据表格
- 支持排序和筛选
- 显示所有评分细节

## 数据库要求

### 必需的环境变量（.env文件）
```env
DB_HOST=your-database-host
DB_PORT=5432
DB_NAME=stock_market
DB_USER=your-username
DB_PASSWORD=your-password
SSL_MODE=require
```

### 必需的数据表结构
```sql
CREATE TABLE lhb_detail (
    stock_code VARCHAR(10),      -- 股票代码
    stock_name VARCHAR(50),      -- 股票名称
    dept_name VARCHAR(200),      -- 营业部名称
    trade_date DATE,             -- 交易日期
    buy_amount NUMERIC,          -- 买入金额
    t2_pct NUMERIC,              -- T+2涨跌幅
    -- 其他字段...
);

-- 建议添加索引
CREATE INDEX idx_lhb_trade_date ON lhb_detail(trade_date);
CREATE INDEX idx_lhb_dept_name ON lhb_detail(dept_name);
CREATE INDEX idx_lhb_stock_code ON lhb_detail(stock_code);
```

## 操作建议解读

### 买入计划
- **🔥 [激进]**: 评分≥80，涨幅2-6%，可低吸介入
- **🛡️ [稳健]**: 评分≥50，等均线支撑再买
- **👀 [观察]**: 评分<50，破开盘价删除
- **⚠️ [严禁追高]**: 竞价额>1亿且涨幅>3%，防止接盘

### T+1卖出
- **高分标的(≥80)**: 次日竞价弱转强则锁仓，否则止盈
- **中分标的(50-80)**: 冲高3-5%止盈，破位止损
- **低分标的(<50)**: 次日不红盘直接走

## 风险提示

⚠️ **重要声明**:
1. 本系统仅供学习研究，不构成投资建议
2. 历史胜率不代表未来表现
3. 龙虎榜数据存在滞后性（T+1公布）
4. 游资操作手法复杂，需结合盘面判断
5. 严格止损，控制仓位

## 故障排查

### 无数据显示
1. 检查 `.env` 文件配置是否正确
2. 确认数据库连接正常: `psql -h $DB_HOST -U $DB_USER -d $DB_NAME`
3. 验证表结构: `\d lhb_detail`
4. 检查数据是否为空: `SELECT COUNT(*) FROM lhb_detail WHERE trade_date >= CURRENT_DATE - 60;`

### 依赖问题
```bash
pip install -r requirements.txt
```

### 网络错误
- AkShare接口可能被限流，稍后重试
- 检查防火墙和代理设置

## 技术架构

```
furtures_terminal.py
├── SmartMoneySniperV5 类
│   ├── connect()                    # 数据库连接
│   ├── get_broker_ranking_data()    # 游资胜率统计
│   ├── get_latent_stock_pool()      # 潜伏池扫描
│   ├── get_realtime_quotes()        # 实时行情
│   ├── get_industry_info()          # 行业信息
│   ├── _get_plans()                 # 策略生成
│   └── generate_signals()           # 主流程
└── Tab6: 善庄狙击界面
    ├── 统计卡片
    ├── 首推标的
    ├── 完整列表
    └── 评分规则说明
```

## 更新日志

### V5.0 (2025-12-23)
- ✅ 集成到 futures_terminal.py
- ✅ 多因子评分系统
- ✅ 智能排序（胜率优先）
- ✅ 实时行情融合
- ✅ 操作建议生成
- ✅ Streamlit 可视化界面

## 贡献者
- 原始代码: Smart Money Sniper V5
- 集成优化: Kilo Code AI Assistant

## 许可证
MIT License